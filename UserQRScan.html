<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href='https://fonts.googleapis.com/css?family=Times New Roman' rel='stylesheet'>
  <link rel="stylesheet" href="userStyles.css">
  <title>Scan QR Code Borrowing Req Form Page</title>
  <!-- QR Scanner Library -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>
  <div class="header">
    <header>  
      <p class="first-line">BTECH</p>
      <input type="text" placeholder="Search..." class="header-search"/>
      <p class="second-line">FURNISHING</p>
    </header>
  </div>
  
  <div class="container">
    <aside class="sidebar">
      <div class="profile">
        <img src="https://raw.githubusercontent.com/iizyyyy/Capstone-Codes/main/images/btechlogo.jpg" alt="User"/>
        <h2> User </h2>
      </div>

      <nav class="nav">
        <a href="UserDashboard.html">
            <button> Dashboard </button>
        </a>

        <a href="UserBorrow.html">
            <button> Reservation Request </button>
        </a>
        
        <a href="UserFurnishing.html">
            <button> Furnishing Management </button>
        </a>

        <a href="UserNotif.html">
            <button> Notifications & Alerts </button>
        </a>

        <a href="UserQRScan.html">
            <button> QR Code Scanning & Quick Access </button>
        </a>

        <a href="UserLogin.html">
            <button>Log out</button>
        </a>
    </nav>
  </aside>

    <div class="main">
      <div class="qr-box">
        <h1>QR Code Scanner - Furnishing Details</h1>
        <div id="qr-reader" class="qr-reader-box" style="width: 300px; margin: auto;"></div>
        <div id="qr-result" style="margin-top: 20px; text-align: center;"></div>
        <button class="scan-qr" onclick="startQrScan()">Scan QR Code</button>   
      </div>
    </div>
  </div>

  <!-- QR Scanner Script -->
        <script>
            let qrScannerStarted = false;

            function startQrScan() {
            if (qrScannerStarted) return;
            qrScannerStarted = true;

            function onScanSuccess(decodedText, decodedResult) {
                document.getElementById('qr-result').innerHTML = `<strong>Scanned:</strong> ${decodedText}`;
                html5QrcodeScanner.clear().then(() => {
                console.log("Scanner stopped");
                }).catch(err => {
                console.error("Failed to stop scanner", err);
                });
            }

            function onScanFailure(error) {
                console.warn(`QR Scan error: ${error}`);
            }

            const html5QrcodeScanner = new Html5QrcodeScanner(
                "qr-reader", 
                { fps: 10, qrbox: 250 }
            );

            html5QrcodeScanner.render(onScanSuccess, onScanFailure);
            }
        </script>
    </body>
</html>